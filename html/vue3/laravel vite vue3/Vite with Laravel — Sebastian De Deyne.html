<!DOCTYPE html>
<!-- saved from url=(0047)https://sebastiandedeyne.com/vite-with-laravel/ -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Vite with Laravel — Sebastian De Deyne</title><link rel="apple-touch-icon" href="https://sebastiandedeyne.com/apple-touch-icon.png"><link rel="icon" type="image/png" href="https://sebastiandedeyne.com/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="https://sebastiandedeyne.com/android-chrome-192x192.png" sizes="192x192"><link rel="icon" type="image/png" href="https://sebastiandedeyne.com/favicon-96x96.png" sizes="96x96"><link rel="icon" type="image/png" href="https://sebastiandedeyne.com/favicon-16x16.png" sizes="16x16"><meta name="theme-color" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://sebastiandedeyne.com/index.xml" title="Sebastian De Deyne"><link rel="alternate" type="application/rss+xml" href="https://sebastiandedeyne.com/articles/index.xml" title="Sebastian De Deyne: Articles"><link rel="alternate" type="application/rss+xml" href="https://sebastiandedeyne.com/newsletter/index.xml" title="Sebastian De Deyne: Newsletter"><link rel="webmention" href="https://webmention.io/sebastiandedeyne.com/webmention"><link rel="pingback" href="https://webmention.io/sebastiandedeyne.com/xmlrpc"><link rel="stylesheet" type="text/css" href="./Vite with Laravel — Sebastian De Deyne_files/fonts.css"><style>blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}button{background-color:initial;background-image:none}button:focus{outline:1px dotted;outline:5px auto -webkit-focus-ring-color}fieldset{margin:0;padding:0}ol,ul{list-style:none;margin:0;padding:0}html{font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,segoe ui,Roboto,helvetica neue,Arial,noto sans,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol,noto color emoji;line-height:1.5}body{font-family:inherit;line-height:inherit}*,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:initial}hr{border-top-width:1px}img{border-style:solid}textarea{resize:vertical}input::placeholder,textarea::placeholder{opacity:1;color:#a1a1aa}button,[role=button]{cursor:pointer}table{border-collapse:collapse}h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}a{color:inherit;text-decoration:inherit}button,input,optgroup,select,textarea{padding:0;line-height:inherit;color:inherit}pre,code,kbd,samp{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,liberation mono,courier new,monospace}img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}img,video{max-width:100%;height:auto}</style><style>:root{--body:white;--shade:#f9fafb;--border:#f3f4f6;--text:#000;--text-light:#9ca3af;--text-inverted:#f3f4f6;--highlight:#3b82f6;--link:#1d4ed8;--button:var(--text);--font-small:0.85rem;--font-medium:0.85rem;--font-large:1.1rem;--font-extra-large:1.5rem;--border-radius:2px}@media(min-width:640px){:root{--font-small:0.65rem;--font-medium:0.75rem;--font-large:1.1rem;--font-extra-large:1.85rem}}@media(prefers-contrast:more){:root{--text-light:#525666}}@media(prefers-color-scheme:dark){:root{--body:#111827;--shade:#1f2937;--border:#374151;--text:#d1d5db;--text-light:#a2a8b4;--highlight:#1d4ed8;--link:#3b82f6;--button:var(--border)}}html{font-size:clamp(16px,2vw,19px)}body{margin:0;color:var(--text);background-color:var(--body);line-height:1.5;font-family:system-ui,-apple-system,BlinkMacSystemFont,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol}hr{border:none;margin:6rem 0 0;position:relative}hr:after{content:'';display:block;background-color:var(--border);width:100%;max-width:10rem;position:absolute;left:50%;top:-3rem;transform:translateX(-50%);height:1px}input[type=email],input[type=submit]{display:inline-block;font:inherit;border-radius:0;-webkit-appearance:none;border:1px solid transparent;border-radius:var(--border-radius);margin:0}input[type=email]{background-color:var(--shade);padding:.25rem .5rem}input[type=submit]{background-color:var(--button);color:#fff;font-weight:500;padding:.25rem .75rem}.wrap{margin:0 auto;max-width:36rem;width:100%;padding-left:.75rem;padding-right:.75rem}@media(min-width:640px){.wrap{padding-left:3rem;padding-right:3rem}}.header{font-size:var(--font-medium);color:var(--text-light);padding:2.5rem 0 3rem;line-height:1.5;background-color:var(--shade);border-bottom:1px solid var(--border)}.header-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem 2rem}.header strong{grid-column:1/-1;font-weight:500;color:var(--text)}.header strong span{font-weight:400;color:var(--text-light)}@media(min-width:640px){.header-grid{grid-template-columns:2fr repeat(3,auto)}.header strong{grid-column:auto}}.header li{padding-left:2ch;position:relative}.header li.active{color:var(--link)}.header li.active:before{content:'→';position:absolute;left:0}.header li a{display:inline-block}.content{min-height:100vh;padding:.75rem 0}@media(min-width:640px){.content{padding:4.5rem 0}}.post header{margin-bottom:1.5rem;text-align:center}@media(min-width:640px){.post header{margin-bottom:3.75rem}}.post header h1{font-size:var(--font-extra-large);font-weight:700;line-height:1.15;padding:0 1.5rem;margin:0 auto}.post header p{color:var(--text-light);font-size:var(--font-medium);margin-top:.25rem}@media(min-width:640px){.post header p{margin-top:.5rem}}.cta{margin-top:1.5rem;color:var(--text-light);font-size:var(--font-medium)}@media(min-width:640px){.cta{margin-top:3rem}}.cta a{position:relative;color:var(--link);text-decoration:underline}.archive{display:grid;gap:1.5rem;line-height:1.25}.archive>li>p{font-size:var(--font-small);color:var(--text-light)}.archive>li li{margin-top:.35rem}.newsletter-form-input-wrapper{display:flex;gap:0}.newsletter-form-input-wrapper input[type=email]{border-radius:var(--border-radius)0 0 var(--border-radius)}.newsletter-form-input-wrapper input[type=submit]{border-radius:0 var(--border-radius)var(--border-radius)0}.newsletter-form p{font-size:var(--font-small);line-height:1.25;color:var(--text-light);margin-top:.25rem}.newsletter-form p a{color:currentColor;text-decoration:none}.markup{position:relative}.markup>*:not(:last-child):not(hr),.markup>details>summary{margin-bottom:1.5rem}.markup+.markup{margin-top:1.5rem}.markup h1{font-size:var(--font-extra-large);font-weight:700;margin-bottom:3rem}.markup h2{font-size:var(--font-large);font-weight:700;margin-top:4.5rem;text-align:center}.markup h2+*{margin-top:2rem}.markup h3{font-weight:700;margin-top:2.25rem}.markup h2+h3{margin-top:1.5rem}.markup a:not(.link-subtle),.markup-link{color:var(--link);text-decoration:underline}.markup em{font-style:italic}.markup em code{font-style:normal}.markup strong{font-weight:600}.markup ul:not(.link-list){list-style-type:none}.markup ul:not(.link-list)>li{padding-left:1.5em;position:relative}.markup ul:not(.link-list)>li:before{content:'–';font-weight:300;position:absolute;left:0}.markup ol{list-style-type:decimal;padding-left:1.33em}.markup .link-list{display:grid;grid-gap:.75em;margin:0 -.25rem}.markup .link-list a{display:block;text-decoration:none;padding:.75em 1.15em;color:var(--text-light);background-color:var(--shade);border-radius:var(--border-radius);font-size:.9em;line-height:1.4}.markup .link-list strong{display:block;font-size:1.1em;font-weight:500;color:var(--text);margin-bottom:.1em}.markup img{display:block;max-width:100%;margin:0 -.25rem;border-radius:var(--border-radius)}.markup img.centered{margin-left:auto;margin-right:auto}.markup figcaption,.markup img+em,.markup pre+em{display:block;font-size:var(--font-small);color:var(--text-light);text-align:center;margin-top:.5rem;margin-bottom:2.5rem}.markup blockquote{padding:.75rem;margin:0 -.75rem;background-color:var(--shade)}@media(min-width:640px){.markup blockquote{padding:1.5rem;margin:0 -.25rem;border-radius:var(--border-radius)}}.markup blockquote cite{display:block;margin-top:1rem;margin-bottom:-1rem;font-size:var(--font-medium);color:var(--text-light)}.markup blockquote cite a{color:inherit}.markup>blockquote>*:not(:last-child){margin-bottom:1rem}.markup .chroma .hl{display:block;position:relative}.markup .chroma .hl:before{content:"";height:2em;position:absolute;left:-1.5rem;width:.66rem;background-color:var(--highlight)}.markup code{font-family:inconsolata,monospace}.markup pre{background-color:var(--button);color:var(--text-inverted);display:block;font-size:.9em;margin:0 -.75rem;overflow-x:auto;padding:.75rem}@media(min-width:640px){.markup pre{padding:1.5rem;margin:0 -.25rem;border-radius:var(--border-radius)}}.markup :not(pre)>code{color:inherit;padding:.1em .25em;background-color:var(--shade);border:1px solid var(--border);border-radius:.2em}.markup iframe{width:100%}.markup table{width:100%;font-variant-numeric:tabular-nums}.markup th{font-weight:400}.markup th,.markup td{font-size:var(--font-medium);padding-top:.25rem;padding-bottom:.25rem;border-bottom:1px solid var(--border)}.markup .breakout{--breakout-width:min(100vw, 54rem);position:relative;right:50%;left:50%;margin-left:calc(var(--breakout-width)/2 * -1);margin-right:calc(var(--breakout-width)/2 * -1);max-width:var(--breakout-width);width:var(--breakout-width)}.toc{border-radius:2px;margin-bottom:1.5rem;background-color:var(--shade);border-radius:var(--border-radius);padding:1.5rem;font-size:var(--font-medium);line-height:1.5}@media(min-width:640px){.toc{display:grid;grid-template-columns:repeat(2,auto);grid-column-gap:1.5rem}}.markup+.toc{margin-top:2.625rem;margin-bottom:0}.toc h2{font-weight:600;margin-bottom:.75rem}.toc ol{counter-reset:toc;list-style:none}.toc ol ol{margin-left:1.5rem}.toc li:before{display:inline-block;counter-increment:toc;content:counter(toc)".";width:1.5rem}.toc li.active:before{content:"→";font-weight:300}.toc a{text-decoration:underline}</style><meta name="description" content="I’ve had an eye on Vite for a while. With a stable release out the door (2.0, as 1.0 never left the release candidate stage) it seemed like a good …"><meta property="og:title" content="Vite with Laravel"><meta property="og:type" content="article"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://sebastiandedeyne.com/vite-with-laravel/"><meta property="og:image" content="https://sebastiandedeyne.com/media/me.jpg"><meta property="og:description" content="I’ve had an eye on Vite for a while. With a stable release out the door (2.0, as 1.0 never left the release candidate stage) it seemed like a good time to give it a shot.
Vite is a frontend build tool like webpack. Instead of bundling development assets, Vite serves native ES modules …"><meta property="article:published_time" content="2021-03-22T06:00:00+0100"><meta property="article:modified_time" content="2021-08-18T10:23:59+0200"><meta property="article:author" content="Sebastian De Deyne"><meta property="article:section" content="Laravel"><script src="./Vite with Laravel — Sebastian De Deyne_files/script.js.下載" data-site="ZJKABUUJ" defer=""></script></head><body><header class="header"><div class="wrap"><div class="header-grid"><strong><a href="https://sebastiandedeyne.com/">Sebastian De Deyne</a><br><span>Designer &amp; developer at Spatie</span></strong><nav><ul><li class="active"><a href="https://sebastiandedeyne.com/">Blog</a></li></ul></nav><nav><ul><li><a href="https://sebastiandedeyne.com/uses">Uses</a></li><li><a href="https://sebastiandedeyne.com/newsletter">Newsletter</a></li></ul></nav><nav><ul><li><a href="https://sebastiandedeyne.com/index.xml">RSS ↗</a></li><li><a href="https://twitter.com/sebdedeyne" rel="me">Twitter ↗</a></li></ul></nav></div></div></header><main class="content"><div class="wrap"><article class="post"><header><h1>Vite with Laravel</h1><p><time datetime="2021-03-22">March 22, 2021</time></p></header><section><div class="markup"><p>I’ve had an eye on Vite for a while. With a stable release out the door (2.0, as 1.0 never left the release candidate stage) it seemed like a good time to give it a shot.</p><p>Vite is a frontend build tool like webpack. Instead of bundling development assets, Vite serves native ES modules transpiled with <a href="https://esbuild.github.io/">esbuild</a> from the dev server. This means there’s a lot less bundling to do, and results in a <em>very</em> fast developer experience. For production builds, Vite uses <a href="https://rollupjs.org/guide/en/">Rollup</a> to bundle the assets.</p></div><div class="markup"><p><em>If you want to delve deeper into Vite’s background, check out <a href="https://vitejs.dev/guide/why.html">Why Vite</a> in their docs. Now, let’s dive into Laravel.</em></p><p>After adding Vite to a JavaScript-heavy Laravel project we’re working on, we saw:</p><ul><li><strong>Faster dev server startup</strong> — <code>npm run hot</code> went from 15s to &lt;1s</li><li><strong>Faster production builds</strong> — <code>npm run production</code> went from from 18s to 15s</li><li><strong>A lot less config &amp; dependencies</strong> — Coming from Webpack (without Laravel Mix) the PR for Vite counts <code>+577 −3,367</code> lines</li><li><strong>Additional develop experience improvements</strong> — Auto-refresh when Blade files change</li></ul><p>This post dives into a basic Vite setup for Laravel. There are also follow-up posts for Blade, Tailwind, Vue, React, TypeScript, and Inertia.</p><p><em>Before getting started, consider not configuring this yourself. <a href="https://laravel-vite.netlify.app/">innocenzi/laravel-vite</a> is an off the shelf solution to add Vite to your Laravel application. If you prefer full ownership over your build tools (like me), or want to learn more about the inner workings, do carry on.</em></p><h2 id="installation">Installation</h2><p>First, clean up Laravel’s default <code>package.json</code> by getting rid of all Laravel Mix dependencies.</p><div class="highlight"><pre class="chroma"><code class="language-diff" data-lang="diff">  {
      "private": true,
      "scripts": {
<span class="gd">-         "dev": "npm run development",
</span><span class="gd">-         "development": "mix",
</span><span class="gd">-         "watch": "mix watch",
</span><span class="gd">-         "watch-poll": "mix watch -- --watch-options-poll=1000",
</span><span class="gd">-         "hot": "mix watch --hot",
</span><span class="gd">-         "prod": "npm run production",
</span><span class="gd">-         "production": "mix --production"
</span><span class="gd"></span>      },
      "devDependencies": {
          "axios": "^0.21",
<span class="gd">-         "laravel-mix": "^6.0.6",
</span><span class="gd"></span>          "lodash": "^4.17.19",
<span class="gd">-         "postcss": "^8.1.14"
</span><span class="gd"></span>      }
  }
</code></pre></div><p>Next, install Vite.</p><div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">npm i vite --dev
</code></pre></div><p>Back in <code>package.json</code>, add the necessary scripts.</p><aside>Use <code>vite --https</code> instead of <code>vite</code> in the <code>dev</code> script if you’re serving your local app over HTTPS.</aside><div class="highlight"><pre class="chroma"><code class="language-diff" data-lang="diff">  {
      "private": true,
      "scripts": {
<span class="gi">+         "dev": "vite",
</span><span class="gi">+         "production": "vite build"
</span><span class="gi"></span>      },
      "devDependencies": {
          "axios": "^0.21",
          "lodash": "^4.17.19",
          "vite": "^2.1.0"
      }
  }
</code></pre></div><h2 id="vite-configuration">Vite configuration</h2><p>Create a <code>vite.config.js</code> file in the project root. Here’s the basic configuration for a Laravel app.</p><div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// vite.config.js
</span><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="p">({</span> <span class="nx">command</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">({</span>
    <span class="nx">base</span><span class="o">:</span> <span class="nx">command</span> <span class="o">===</span> <span class="s1">'serve'</span> <span class="o">?</span> <span class="s1">''</span> <span class="o">:</span> <span class="s1">'/build/'</span><span class="p">,</span>
    <span class="nx">publicDir</span><span class="o">:</span> <span class="s1">'fake_dir_so_nothing_gets_copied'</span><span class="p">,</span>
    <span class="nx">build</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">manifest</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">outDir</span><span class="o">:</span> <span class="s1">'public/build'</span><span class="p">,</span>
        <span class="nx">rollupOptions</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">input</span><span class="o">:</span> <span class="s1">'resources/js/app.js'</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">});</span>
</code></pre></div><p><code>build.rollupOptions.input</code> should point to the main input of our app. <strong>Important!</strong> This should only be a script. Stylesheets should be imported from the script, otherwise they won’t appear in <code>manifest.json</code>.</p><p><code>build.manifest</code> generates a <code>manifest.json</code> file our Laravel app will read to discover the asset file names.</p><p><code>build.outDir</code> determines where the final build will end up. In a Laravel app, this must be in the <code>public</code> directory. I recommend a subdirectory like <code>public/build</code> to make it easier to <code>.gitignore</code>.</p><p>Because we modified the <code>outDir</code>, we need to configure <code>base</code>. This ensures all of the path references in the files Vite generates will also point to <code>/build/</code>. On the development server (<code>command === 'serve'</code>), assets are served from <code>http://localhost:3000</code>. Because <code>outDir</code> isn’t used on the development server, we shouldn’t override <code>base</code>.</p><p>All files in <code>publicDir</code> get copied over to the <code>outDir</code> on build. This is how Vite <a href="https://vitejs.dev/guide/assets.html#the-public-directory">deals with static assets</a> in a SPA. Since we already have Laravel’s <code>public</code> directory, this isn’t relevant to us. Unfortunately there’s no way to disable this, so we’ll provide a fake path so nothing gets copied.</p><p>Before moving on to the Laravel configuration, we need to make some changes to the default <code>app.js</code> file.</p><ul><li>As mentioned, CSS should be imported from JavaScript</li><li>Replace all <code>require</code> statements with <code>import</code>, as Vite requires us to use ES modules</li><li>Import Vite’s dynamic import polyfill</li></ul><div class="highlight"><pre class="chroma"><code class="language-js" data-lang="js"><span class="c1">// resources/js/app.js
</span><span class="c1"></span><span class="kr">import</span> <span class="s1">'vite/dynamic-import-polyfill'</span><span class="p">;</span>

<span class="kr">import</span> <span class="s1">'../css/app.css'</span><span class="p">;</span>

<span class="kr">import</span> <span class="s1">'./bootstrap'</span><span class="p">;</span>
</code></pre></div><p>The <code>bootstrap.js</code> file also has some <code>requires</code> that need to be reworked.</p><div class="highlight"><pre class="chroma"><code class="language-diff" data-lang="diff"><span class="gi">+ import _ from 'lodash';
</span><span class="gi">+ import axios from 'axios';
</span><span class="gi">+ 
</span><span class="gi"></span><span class="gd">- window._ = require('lodash');
</span><span class="gd"></span><span class="gi">+ window._ = _;
</span><span class="gi"></span>  
  /**
   * We'll load the axios HTTP library which allows us to easily issue requests
   * to our Laravel back-end. This library automatically handles sending the
   * CSRF token as a header based on the value of the "XSRF" token cookie.
   */
  
<span class="gd">- window.axios = require('axios');
</span><span class="gd"></span><span class="gi">+ window.axios = axios;
</span><span class="gi"></span>  
  window.axios.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
  
  /**
   * Echo exposes an expressive API for subscribing to channels and listening
   * for events that are broadcast by Laravel. Echo and event broadcasting
   * allows your team to easily build robust real-time web applications.
   */
  
  // import Echo from 'laravel-echo';
<span class="gi">+ // import Pusher from 'pusher-js';
</span><span class="gi"></span>  
<span class="gd">- // window.Pusher = require('pusher-js');
</span><span class="gd"></span><span class="gi">+ // window.Pusher = Pusher;
</span><span class="gi"></span>  
  // window.Echo = new Echo({
  //     broadcaster: 'pusher',
  //     key: process.env.MIX_PUSHER_APP_KEY,
  //     cluster: process.env.MIX_PUSHER_APP_CLUSTER,
  //     forceTLS: true
  // });
</code></pre></div><p>All configured!</p><p>If we run <code>npm run dev</code>, the dev server should start at <code>http://localhost:3000</code>. If we run <code>npm run production</code> a bundle should generate in <code>public/build</code>.</p><h2 id="laravel-configuration">Laravel configuration</h2><p>With the build pipeline up and running, it’s time to load the assets in the application.</p><p>First the dev server. When we run <code>npm run dev</code>, Vite spins up a dev server with hot module replacement enabled on <code>localhost:3000</code>.</p><p>To load our app, load Vite’s runtime, then create a <code>module</code> <code>script</code> tag that points to our entry filename on <code>localhost:3000</code>.</p><aside>If you used the <code>--https</code> option in the previous steps, these scripts will be served from <code>https://localhost:3000/</code> instead.</aside><div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"module"</span> <span class="na">src</span><span class="o">=</span><span class="s">"http://localhost:3000/@vite/client"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"module"</span> <span class="na">src</span><span class="o">=</span><span class="s">"http://localhost:3000/resources/js/app.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</code></pre></div><p>When we run <code>npm run production</code> we need to find the exact asset path in the manifest, generated at <code>public/build/manifest.json</code>.</p><div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">"resources/js/app.js"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"file"</span><span class="p">:</span> <span class="s2">"assets/app.e8ed53e0.js"</span><span class="p">,</span>
    <span class="nt">"src"</span><span class="p">:</span> <span class="s2">"resources/js/app.js"</span><span class="p">,</span>
    <span class="nt">"isEntry"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">"imports"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"_vendor.0c0b30aa.js"</span>
    <span class="p">],</span>
    <span class="nt">"css"</span><span class="p">:</span> <span class="p">[</span>
      <span class="s2">"assets/app.1ce589ef.css"</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="nt">"_vendor.0c0b30aa.js"</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">"file"</span><span class="p">:</span> <span class="s2">"assets/vendor.0c0b30aa.js"</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>This requires a few more steps:</p><ul><li>Read the <code>manifest.json</code> file</li><li>Extract the script location and render a <code>script</code> element</li><li>Extract the stylesheet location and render a <code>link</code> element</li></ul><div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">@php
    $manifest = json_decode(file_get_contents(public_path('build/manifest.json')), true);
@endphp
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"module"</span> <span class="na">src</span><span class="o">=</span><span class="s">"/build/{$manifest['resources/js/app.js']['file']}"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"/build/{$manifest['resources/js/app.js']['css'][0]}"</span><span class="p">&gt;</span>
</code></pre></div><p>Don’t forget to prefix the path with the base path!</p><p>To ensure the right assets are loaded in every environment, combine the previous snippets with a <code>@production</code> directive.</p><div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">@production
    @php
        $manifest = json_decode(file_get_contents(public_path('build/manifest.json')), true);
    @endphp
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"module"</span> <span class="na">src</span><span class="o">=</span><span class="s">"/build/{$manifest['resources/js/app.js']['file']}"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">"stylesheet"</span> <span class="na">href</span><span class="o">=</span><span class="s">"/build/{$manifest['resources/js/app.js']['css'][0]}"</span><span class="p">&gt;</span>
@else
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"module"</span> <span class="na">src</span><span class="o">=</span><span class="s">"http://localhost:3000/@vite/client"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">"module"</span> <span class="na">src</span><span class="o">=</span><span class="s">"http://localhost:3000/resources/js/app.js"</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
@endproduction
</code></pre></div><h2 id="better-dx-for-non-frontend-developers">Better DX for non-frontend developers</h2><p>The above setup forces you to run <code>npm run dev</code> and watch on local. However, often backend developers working on the application don’t need to watch the assets for changes.</p><p>Devs can run <code>npm run production</code> to generate assets once, but the application will still try to load assets from <code>locahost:3000</code>. The <code>production</code> check we have in place isn’t enough.</p><p>To work around this, we can ping <code>localhost:3000</code>. If it connects, we know the dev server is running and we can render the hot scripts.</p><aside>This could go in a <code>helpers.php</code> file, learn how to set one up <a href="https://laravel-news.com/creating-helpers">here</a>.</aside><p>First, let’s extract the code we had written in our Blade template to a helper function. Next, we’ll use Laravel <code>Http</code> facade to ping <code>localhost:3000</code>. If it connects, we know the dev server is running.</p><div class="highlight"><pre class="chroma"><code class="language-php" data-lang="php"><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\HtmlString</span><span class="p">;</span>

<span class="k">function</span> <span class="nf">vite_assets</span><span class="p">()</span><span class="o">:</span> <span class="nx">HtmlString</span>
<span class="p">{</span>
    <span class="nv">$devServerIsRunning</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">app</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">environment</span><span class="p">(</span><span class="s1">'local'</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">Http</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s2">"http://localhost:3000"</span><span class="p">);</span>
            <span class="nv">$devServerIsRunning</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nv">$devServerIsRunning</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">HtmlString</span><span class="p">(</span><span class="o">&lt;&lt;&lt;</span><span class="nx">HTML</span>
            <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"module"</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"http://localhost:3000/@vite/client"</span><span class="o">&gt;&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"module"</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"http://localhost:3000/resources/js/app.js"</span><span class="o">&gt;&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
        <span class="nx">HTML</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nv">$manifest</span> <span class="o">=</span> <span class="nx">json_decode</span><span class="p">(</span><span class="nx">file_get_contents</span><span class="p">(</span>
        <span class="nx">public_path</span><span class="p">(</span><span class="s1">'build/manifest.json'</span><span class="p">)</span>
    <span class="p">),</span> <span class="k">true</span><span class="p">);</span>
    
    <span class="k">return</span> <span class="k">new</span> <span class="nx">HtmlString</span><span class="p">(</span><span class="o">&lt;&lt;&lt;</span><span class="nx">HTML</span>
        <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">"module"</span> <span class="nx">src</span><span class="o">=</span><span class="s2">"/build/</span><span class="si">{</span><span class="nv">$manifest</span><span class="p">[</span><span class="s1">'resources/js/app.js'</span><span class="p">][</span><span class="s1">'file'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="o">&gt;&lt;/</span><span class="nx">script</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">link</span> <span class="nx">rel</span><span class="o">=</span><span class="s2">"stylesheet"</span> <span class="nx">href</span><span class="o">=</span><span class="s2">"/build/</span><span class="si">{</span><span class="nv">$manifest</span><span class="p">[</span><span class="s1">'resources/js/app.js'</span><span class="p">][</span><span class="s1">'css'</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="o">&gt;</span>
    <span class="nx">HTML</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div><p>Finally, echo the assets in our application’s layout template.</p><div class="highlight"><pre class="chroma"><code class="language-html" data-lang="html">{{ vite_assets() }}
</code></pre></div><p>Ready to go! Vite is set up in our Laravel application. The next step is to add additional configuration based on the tooling we’ll use.</p></div><aside class="toc"><h2>Vite with Laravel</h2><ol><li class="active">Up and running</li><li><a href="https://sebastiandedeyne.com/vite-with-laravel/blade">Auto-refresh Blade views</a></li><li><a href="https://sebastiandedeyne.com/vite-with-laravel/tailwind">Using Tailwind CSS</a></li><li><a href="https://sebastiandedeyne.com/vite-with-laravel/vue">Using Vue.js</a></li><li><a href="https://sebastiandedeyne.com/vite-with-laravel/react">Using React</a></li><li><a href="https://sebastiandedeyne.com/vite-with-laravel/typescript">Using TypeScript</a></li><li><a href="https://sebastiandedeyne.com/vite-with-laravel/inertia">Using Inertia.js</a></li></ol></aside></section></article><p class="cta">If you enjoyed this post, you might be interested in my <a href="https://sebastiandedeyne.com/newsletter">newsletter</a>. I occasionally send a dispatch with personal stories, things I’ve been working on in the past month, and other interesting tidbits I come across online.</p></div></main><style>.chroma{color:#f8f8f2;background-color:#282a36}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#96cbfe}.chroma .kc{color:#96cbfe}.chroma .kd{color:#96cbfe}.chroma .kn{color:#96cbfe}.chroma .kp{color:#96cbfe}.chroma .kr{color:#96cbfe}.chroma .kt{color:#96cbfe}.chroma .na{color:#96cbfe}.chroma .nb{color:#96cbfe}.chroma .nc{color:#96cbfe}.chroma .nf{color:#96cbfe}.chroma .nl{color:#96cbfe}.chroma .nt{color:#96cbfe}.chroma .nv{color:#96cbfe}.chroma .vc{color:#96cbfe}.chroma .vg{color:#96cbfe}.chroma .vi{color:#96cbfe}.chroma .s{color:#a8ff60}.chroma .sa{color:#a8ff60}.chroma .sb{color:#a8ff60}.chroma .sc{color:#a8ff60}.chroma .dl{color:#a8ff60}.chroma .sd{color:#a8ff60}.chroma .s2{color:#a8ff60}.chroma .se{color:#a8ff60}.chroma .sh{color:#a8ff60}.chroma .si{color:#a8ff60}.chroma .sx{color:#a8ff60}.chroma .sr{color:#a8ff60}.chroma .s1{color:#a8ff60}.chroma .ss{color:#a8ff60}.chroma .m{color:#bd93f9}.chroma .mb{color:#bd93f9}.chroma .mf{color:#bd93f9}.chroma .mh{color:#bd93f9}.chroma .mi{color:#bd93f9}.chroma .il{color:#bd93f9}.chroma .mo{color:#bd93f9}.chroma .o{color:#96cbfe}.chroma .ow{color:#96cbfe}.chroma .c{color:#757c90}.chroma .ch{color:#757c90}.chroma .cm{color:#757c90}.chroma .c1{color:#757c90}.chroma .cs{color:#757c90}.chroma .cp{color:#96cbfe}.chroma .cpf{color:#96cbfe}.chroma .gd{color:#f33035}.chroma .ge{text-decoration:underline}.chroma .gh{font-weight:700}.chroma .gi{color:#a8ff60}.chroma .go{color:#44475a}.chroma .gu{font-weight:700}.chroma .gl{text-decoration:underline}</style><div id="extwaiokist" style="display:none" v="obocp" q="64c3ba9b" c="707.9" i="14" u="2.059" s="09012221" d="1" w="false" e="" a="2" m="BMe=" vn="3gtr1"><div id="extwaigglbit" style="display:none" v="obocp" q="64c3ba9b" c="707.9" i="14" u="2.059" s="09012221" d="1" w="false" e="" a="2" m="BMe="></div></div></body></html>